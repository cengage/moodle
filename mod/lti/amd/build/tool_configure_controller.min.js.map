{"version":3,"sources":["../src/tool_configure_controller.js"],"names":["define","$","ajax","notification","templates","ltiEvents","KEYS","toolType","toolProxy","str","SELECTORS","EXTERNAL_REGISTRATION_CONTAINER","EXTERNAL_REGISTRATION_PAGE_CONTAINER","CARTRIDGE_REGISTRATION_CONTAINER","CARTRIDGE_REGISTRATION_FORM","LTIADV_REGISTRATION_CONTAINER","ADD_TOOL_FORM","TOOL_LIST_CONTAINER","TOOL_CREATE_BUTTON","TOOL_CREATE_LTI2_BUTTON","REGISTRATION_CHOICE_CONTAINER","TOOL_URL","getToolCreateButton","getToolListContainer","getExternalRegistrationContainer","getCartridgeRegistrationContainer","getRegistrationChoiceContainer","getLTIAdvRegistrationContainer","showLTIAdvRegistrationContainer","hideCartridgeRegistration","hideRegistrationChoices","removeClass","initiateRegistration","url","container","iframe","append","encodeURIComponent","window","addEventListener","e","data","subject","remove","getToolURL","val","hideExternalRegistration","addClass","showExternalRegistration","screenReaderAnnounce","showCartridgeRegistration","find","attr","showRegistrationChoices","element","children","detach","appendTo","hideToolList","showToolList","showRegistrationFeedback","type","error","addNotification","message","startLoading","stopLoading","reloadToolList","promise","Deferred","when","query","done","types","proxies","render","tools","html","js","empty","runTemplateJS","resolve","fail","reject","exception","always","addLTIAdvTool","trim","toolButton","document","trigger","START_LTIADV_REGISTRATION","addLTI2Tool","isCartridge","result","iscartridge","START_CARTRIDGE_REGISTRATION","START_EXTERNAL_REGISTRATION","get_string","s","REGISTRATION_FEEDBACK","registerEventListeners","on","NEW_TOOL_TYPE","STOP_EXTERNAL_REGISTRATION","event","STOP_CARTRIDGE_REGISTRATION","removeAttr","form","submit","preventDefault","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Standard Ajax wrapper for Moodle. It calls the central Ajax script,\n * which can call any existing webservice using the current session.\n * In addition, it can batch multiple requests and return multiple responses.\n *\n * @module     mod_lti/tool_configure_controller\n * @class      tool_configure_controller\n * @package    mod_lti\n * @copyright  2015 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/templates', 'mod_lti/events', 'mod_lti/keys', 'mod_lti/tool_type',\n        'mod_lti/tool_proxy', 'core/str'],\n        function($, ajax, notification, templates, ltiEvents, KEYS, toolType, toolProxy, str) {\n\n    var SELECTORS = {\n        EXTERNAL_REGISTRATION_CONTAINER: '#external-registration-container',\n        EXTERNAL_REGISTRATION_PAGE_CONTAINER: '#external-registration-page-container',\n        CARTRIDGE_REGISTRATION_CONTAINER: '#cartridge-registration-container',\n        CARTRIDGE_REGISTRATION_FORM: '#cartridge-registration-form',\n        LTIADV_REGISTRATION_CONTAINER: '#ltiadv-registration-container',\n        ADD_TOOL_FORM: '#add-tool-form',\n        TOOL_LIST_CONTAINER: '#tool-list-container',\n        TOOL_CREATE_BUTTON: '#tool-create-button',\n        TOOL_CREATE_LTI2_BUTTON: '#tool-createlti2-button',\n        REGISTRATION_CHOICE_CONTAINER: '#registration-choice-container',\n        TOOL_URL: '#tool-url'\n    };\n\n    /**\n     * Get the tool create button element.\n     *\n     * @method getToolCreateButton\n     * @private\n     * @return {Object} jQuery object\n     */\n    var getToolCreateButton = function() {\n        return $(SELECTORS.TOOL_CREATE_BUTTON);\n    };\n\n    /**\n     * Get the tool list container element.\n     *\n     * @method getToolListContainer\n     * @private\n     * @return {Object} jQuery object\n     */\n    var getToolListContainer = function() {\n        return $(SELECTORS.TOOL_LIST_CONTAINER);\n    };\n\n    /**\n     * Get the external registration container element.\n     *\n     * @method getExternalRegistrationContainer\n     * @private\n     * @return {Object} jQuery object\n     */\n    var getExternalRegistrationContainer = function() {\n        return $(SELECTORS.EXTERNAL_REGISTRATION_CONTAINER);\n    };\n\n    /**\n     * Get the cartridge registration container element.\n     *\n     * @method getCartridgeRegistrationContainer\n     * @private\n     * @return {Object} jQuery object\n     */\n    var getCartridgeRegistrationContainer = function() {\n        return $(SELECTORS.CARTRIDGE_REGISTRATION_CONTAINER);\n    };\n\n    /**\n     * Get the registration choice container element.\n     *\n     * @method getRegistrationChoiceContainer\n     * @private\n     * @return {Object} jQuery object\n     */\n    var getRegistrationChoiceContainer = function() {\n        return $(SELECTORS.REGISTRATION_CHOICE_CONTAINER);\n    };\n\n    /**\n     * Return the container that holds all elements for the external registration, including\n     * the cancel button and the iframe.\n     *\n     * @method getExternalRegistrationContainer\n     * @private\n     * @return {JQuery} jQuery object\n     */\n    var getLTIAdvRegistrationContainer = function() {\n        return $(SELECTORS.LTIADV_REGISTRATION_CONTAINER);\n    };\n\n\n    /**\n     * Stops displaying the external registration content.\n     *\n     * @method hideExternalRegistrationContent\n     * @private\n    var hideLTIAdvRegistrationContainer = function() {\n        getLTIAdvRegistrationContainer().addClass('hidden');\n    };\n*/\n    /**\n     * Displays the external registration content.\n     *\n     * @method showExternalRegistrationContent\n     * @private\n     */\n    var showLTIAdvRegistrationContainer = function() {\n        hideCartridgeRegistration();\n        hideRegistrationChoices();\n        getLTIAdvRegistrationContainer().removeClass('hidden');\n        //screenReaderAnnounce(getExternalRegistrationContainer());\n    };\n\n    /**\n     * Load the external registration template and render it in the DOM and display it.\n     *\n     * @method renderExternalRegistrationWindow\n     * @private\n     * @param {Object} registrationRequest\n     * @return {Promise} jQuery Deferred object\n     */\n    var initiateRegistration = function(url) {\n\n        // Show the external registration page in an iframe.\n        var container = getLTIAdvRegistrationContainer();\n        var iframe = container.append(\"<iframe src='/mod/lti/startltiadvregistration.php?url=\"\n                         + encodeURIComponent( url ) + \"'></iframe>\");\n        showLTIAdvRegistrationContainer();\n        window.addEventListener(\"message\", (e=>{\n            if (e.data && 'org.imsglobal.lti.close' === e.data.subject) {\n                iframe.remove();\n            }\n        }), false);\n    };\n\n    /**\n     * Get the tool type URL.\n     *\n     * @method getToolURL\n     * @private\n     * @return {String} the tool type url\n     */\n    var getToolURL = function() {\n        return $(SELECTORS.TOOL_URL).val();\n    };\n\n    /**\n     * Hide the external registration container.\n     *\n     * @method hideExternalRegistration\n     * @private\n     */\n    var hideExternalRegistration = function() {\n        getExternalRegistrationContainer().addClass('hidden');\n    };\n\n    /**\n     * Hide the cartridge registration container.\n     *\n     * @method hideCartridgeRegistration\n     * @private\n     */\n    var hideCartridgeRegistration = function() {\n        getCartridgeRegistrationContainer().addClass('hidden');\n    };\n\n    /**\n     * Hide the registration choice container.\n     *\n     * @method hideRegistrationChoices\n     * @private\n     */\n    var hideRegistrationChoices = function() {\n        getRegistrationChoiceContainer().addClass('hidden');\n    };\n\n    /**\n     * Display the external registration panel and hides the other\n     * panels.\n     *\n     * @method showExternalRegistration\n     * @private\n     */\n    var showExternalRegistration = function() {\n        hideCartridgeRegistration();\n        hideRegistrationChoices();\n        getExternalRegistrationContainer().removeClass('hidden');\n        screenReaderAnnounce(getExternalRegistrationContainer());\n    };\n\n    /**\n     * Display the cartridge registration panel and hides the other\n     * panels.\n     *\n     * @method showCartridgeRegistration\n     * @param {String} url\n     * @private\n     */\n    var showCartridgeRegistration = function(url) {\n        hideExternalRegistration();\n        hideRegistrationChoices();\n        // Don't save the key and secret from the last tool.\n        var container = getCartridgeRegistrationContainer();\n        container.find('input').val('');\n        container.removeClass('hidden');\n        container.find(SELECTORS.CARTRIDGE_REGISTRATION_FORM).attr('data-cartridge-url', url);\n        screenReaderAnnounce(container);\n    };\n\n    /**\n     * Display the registration choices panel and hides the other\n     * panels.\n     *\n     * @method showRegistrationChoices\n     * @private\n     */\n    var showRegistrationChoices = function() {\n        hideExternalRegistration();\n        hideCartridgeRegistration();\n        getRegistrationChoiceContainer().removeClass('hidden');\n        screenReaderAnnounce(getRegistrationChoiceContainer());\n    };\n\n    /**\n     * JAWS does not notice visibility changes with aria-live.\n     * Remove and add the content back to force it to read it out.\n     * This function can be removed once JAWS supports visibility.\n     *\n     * @method screenReaderAnnounce\n     * @param {Object} element\n     * @private\n     */\n    var screenReaderAnnounce = function(element) {\n        var children = element.children().detach();\n        children.appendTo(element);\n    };\n\n    /**\n     * Hides the list of tool types.\n     *\n     * @method hideToolList\n     * @private\n     */\n    var hideToolList = function() {\n        getToolListContainer().addClass('hidden');\n    };\n\n    /**\n     * Display the list of tool types.\n     *\n     * @method hideToolList\n     * @private\n     */\n    var showToolList = function() {\n        getToolListContainer().removeClass('hidden');\n    };\n\n    /**\n     * Display the registration feedback alert and hide the other panels.\n     *\n     * @method showRegistrationFeedback\n     * @param {Object} data\n     * @private\n     */\n    var showRegistrationFeedback = function(data) {\n        var type = data.error ? 'error' : 'success';\n        notification.addNotification({\n            message: data.message,\n            type: type\n        });\n    };\n\n    /**\n     * Show the loading animation\n     *\n     * @method startLoading\n     * @private\n     * @param {Object} element jQuery object\n     */\n    var startLoading = function(element) {\n        element.addClass(\"loading\");\n    };\n\n    /**\n     * Hide the loading animation\n     *\n     * @method stopLoading\n     * @private\n     * @param {Object} element jQuery object\n     */\n    var stopLoading = function(element) {\n        element.removeClass(\"loading\");\n    };\n\n    /**\n     * Refresh the list of tool types and render the new ones.\n     *\n     * @method reloadToolList\n     * @private\n     */\n    var reloadToolList = function() {\n        var promise = $.Deferred();\n        var container = getToolListContainer();\n        startLoading(container);\n\n        $.when(\n                toolType.query(),\n                toolProxy.query({'orphanedonly': true})\n            )\n            .done(function(types, proxies) {\n                    templates.render('mod_lti/tool_list', {tools: types, proxies: proxies})\n                        .done(function(html, js) {\n                                container.empty();\n                                container.append(html);\n                                templates.runTemplateJS(js);\n                                promise.resolve();\n                            }).fail(promise.reject);\n                })\n            .fail(promise.reject);\n\n        promise.fail(notification.exception)\n            .always(function() {\n                    stopLoading(container);\n                });\n    };\n\n    /**\n     * Trigger appropriate registration process process for the user input\n     * URL. It can either be a cartridge or a registration url.\n     *\n     * @method addLTIAdvTool\n     * @private\n     * @return {Promise} jQuery Deferred object\n     */\n    var addLTIAdvTool = function() {\n        var url = $.trim(getToolURL());\n\n        if (url !== \"\") {\n            var toolButton = getToolCreateButton();\n            startLoading(toolButton);\n\n            $(document).trigger(ltiEvents.START_LTIADV_REGISTRATION, {url: url});\n        }\n\n    };\n\n    /**\n     * Trigger appropriate registration process process for the user input\n     * URL. It can either be a cartridge or a registration url.\n     *\n     * @method addLTI2Tool\n                        <button id=\"tool-create-button\" type=\"submit\" class=\"btn btn-success\">\n                        <button id=\"tool-create-button\" type=\"submit\" class=\"btn btn-success\">\n                        <button id=\"tool-create-button\" type=\"submit\" class=\"btn btn-success\">\n                        <button id=\"tool-create-button\" type=\"submit\" class=\"btn btn-success\">\n                            <span class=\"btn-text\">{{#str}} add {{/str}}</span>\n                            <div class=\"btn-loader\">\n                                {{> mod_lti/loader }}\n                            </div>\n                        </button>\n                            <span class=\"btn-text\">{{#str}} add {{/str}}</span>\n                            <div class=\"btn-loader\">\n                                {{> mod_lti/loader }}\n                            </div>\n                        </button>\n                            <span class=\"btn-text\">{{#str}} add {{/str}}</span>\n                            <div class=\"btn-loader\">\n                                {{> mod_lti/loader }}\n                            </div>\n                        </button>\n                            <span class=\"btn-text\">{{#str}} add {{/str}}</span>\n                            <div class=\"btn-loader\">\n                                {{> mod_lti/loader }}\n                            </div>\n                        </button>\n     * @private\n     * @return {Promise} jQuery Deferred object\n     */\n    var addLTI2Tool = function() {\n        var url = $.trim(getToolURL());\n\n        if (url === \"\") {\n            return $.Deferred().resolve();\n        }\n        var toolButton = $(SELECTORS.TOOL_CREATE_LTI2_BUTTON);\n        var toolButton = getToolCreateButton();\n        startLoading(toolButton);\n\n        var promise = toolType.isCartridge(url);\n\n        promise.always(function() {\n          stopLoading(toolButton);\n        });\n\n        promise.done(function(result) {\n            if (result.iscartridge) {\n                $(SELECTORS.TOOL_URL).val('');\n                $(document).trigger(ltiEvents.START_CARTRIDGE_REGISTRATION, url);\n            } else {\n                $(document).trigger(ltiEvents.START_EXTERNAL_REGISTRATION, {url: url});\n            }\n        });\n\n        promise.fail(function() {\n            str.get_string('errorbadurl', 'mod_lti')\n                .done(function(s) {\n                        $(document).trigger(ltiEvents.REGISTRATION_FEEDBACK, {\n                                message: s,\n                                error: true\n                            });\n                    })\n                .fail(notification.exception);\n        });\n\n        return promise;\n    };\n\n    /**\n     * Sets up the listeners for user interaction on the page.\n     *\n     * @method registerEventListeners\n     * @private\n     */\n    var registerEventListeners = function() {\n\n        // These are events fired by the registration processes. Either\n        // the cartridge registration or the external registration url.\n        $(document).on(ltiEvents.NEW_TOOL_TYPE, function() {\n            reloadToolList();\n        });\n\n        $(document).on(ltiEvents.START_EXTERNAL_REGISTRATION, function() {\n            showExternalRegistration();\n            $(SELECTORS.TOOL_URL).val('');\n            hideToolList();\n        });\n\n        $(document).on(ltiEvents.STOP_EXTERNAL_REGISTRATION, function() {\n            showToolList();\n            showRegistrationChoices();\n        });\n\n        $(document).on(ltiEvents.START_CARTRIDGE_REGISTRATION, function(event, url) {\n            showCartridgeRegistration(url);\n        });\n\n        $(document).on(ltiEvents.STOP_CARTRIDGE_REGISTRATION, function() {\n            getCartridgeRegistrationContainer().find(SELECTORS.CARTRIDGE_REGISTRATION_FORM).removeAttr('data-cartridge-url');\n            showRegistrationChoices();\n        });\n\n        $(document).on(ltiEvents.START_LTIADV_REGISTRATION, function(event, data) {\n                if (!data) {\n                    return;\n                }\n                if (data.url) {\n                    $(SELECTORS.TOOL_URL).val('');\n                    hideToolList();\n                    initiateRegistration(data.url);\n                }\n        });\n\n        $(document).on(ltiEvents.REGISTRATION_FEEDBACK, function(event, data) {\n            showRegistrationFeedback(data);\n        });\n\n        var form = $(SELECTORS.TOOL_CREATE_LTI2_BUTTON);\n        form.submit(function(e) {\n            e.preventDefault();\n            addLTI2Tool();\n        });\n\n        var form = $(SELECTORS.ADD_TOOL_FORM);\n        form.submit(function(e) {\n            e.preventDefault();\n            addLTIAdvTool();\n        });\n\n    };\n\n    return /** @alias module:mod_lti/cartridge_registration_form */ {\n\n        /**\n         * Initialise this module.\n         */\n        init: function() {\n            registerEventListeners();\n            reloadToolList();\n        }\n    };\n});\n"],"file":"tool_configure_controller.min.js"}