{"version":3,"sources":["../src/ltiadv_registration.js"],"names":["define","$","ltiEvents","SELECTORS","LTIADV_REGISTRATION_CONTAINER","getLTIAdvRegistrationContainer","showLTIAdvRegistrationContainer","removeClass","initiateRegistration","url","container","iframe","append","encodeURIComponent","window","addEventListener","e","data","subject","remove","registerEventListeners","document","on","START_LTIADV_REGISTRATION","event","init"],"mappings":"AA+BAA,OAAM,+BAAC,CAAC,QAAD,CAAW,gBAAX,CAAD,CACE,SAASC,CAAT,CAAYC,CAAZ,CAAuB,IAEvBC,CAAAA,CAAS,CAAG,CACZC,6BAA6B,CAAE,gCADnB,CAFW,CAcvBC,CAA8B,CAAG,UAAW,CAC5C,MAAOJ,CAAAA,CAAC,CAACE,CAAS,CAACC,6BAAX,CACX,CAhB0B,CAkCvBE,CAA+B,CAAG,UAAW,CAC7CD,CAA8B,GAAGE,WAAjC,CAA6C,QAA7C,CACH,CApC0B,CA8CvBC,CAAoB,CAAG,SAASC,CAAT,CAAc,IAGjCC,CAAAA,CAAS,CAAGL,CAA8B,EAHT,CAIjCM,CAAM,CAAGD,CAAS,CAACE,MAAV,CAAiB,yDACxBC,kBAAkB,CAAEJ,CAAF,CADM,CACI,aADrB,CAJwB,CAMrCH,CAA+B,GAE/BQ,MAAM,CAACC,gBAAP,CAAwB,SAAxB,CAAoC,SAAAC,CAAC,CAAE,CACnC,GAAIA,CAAC,CAACC,IAAF,EAAU,yBAA2BD,CAAC,CAACC,IAAF,CAAOC,OAAhD,CAAyD,CACrDP,CAAM,CAACQ,MAAP,EACH,CACJ,CAJD,IAKH,CA3D0B,CAmEvBC,CAAsB,CAAG,UAAW,CAEpCnB,CAAC,CAACoB,QAAD,CAAD,CAAYC,EAAZ,CAAepB,CAAS,CAACqB,yBAAzB,CAAoD,SAASC,CAAT,CAAgBP,CAAhB,CAAsB,CAClE,GAAI,CAACA,CAAL,CAAW,CACP,MACH,CACD,GAAIA,CAAI,CAACR,GAAT,CAAc,CACVD,CAAoB,CAACS,CAAI,CAACR,GAAN,CACvB,CACJ,CAPL,CAiBH,CAtF0B,CAwF3B,MAA0D,CAKtDgB,IAAI,CAAE,eAAW,CACbL,CAAsB,EACzB,CAPqD,CAS7D,CAlGK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Encapsules the behavior for creating a tool type and tool proxy from a\n * registration url in Moodle.\n *\n * Manages the UI while operations are occuring, including rendering external\n * registration page within the iframe.\n *\n * See template: mod_lti/external_registration\n *\n * @module     mod_lti/external_registration\n * @class      external_registration\n * @package    mod_lti\n * @copyright  2015 Ryan Wyllie <ryan@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['jquery', 'mod_lti/events'],\n        function($, ltiEvents) {\n\n    var SELECTORS = {\n        LTIADV_REGISTRATION_CONTAINER: '#ltiadv-registration-container'\n    };\n\n    /**\n     * Return the container that holds all elements for the external registration, including\n     * the cancel button and the iframe.\n     *\n     * @method getExternalRegistrationContainer\n     * @private\n     * @return {JQuery} jQuery object\n     */\n    var getLTIAdvRegistrationContainer = function() {\n        return $(SELECTORS.LTIADV_REGISTRATION_CONTAINER);\n    };\n\n\n    /**\n     * Stops displaying the external registration content.\n     *\n     * @method hideExternalRegistrationContent\n     * @private\n    var hideLTIAdvRegistrationContainer = function() {\n        getLTIAdvRegistrationContainer().addClass('hidden');\n    };\n*/\n    /**\n     * Displays the external registration content.\n     *\n     * @method showExternalRegistrationContent\n     * @private\n     */\n    var showLTIAdvRegistrationContainer = function() {\n        getLTIAdvRegistrationContainer().removeClass('hidden');\n    };\n\n    /**\n     * Load the external registration template and render it in the DOM and display it.\n     *\n     * @method renderExternalRegistrationWindow\n     * @private\n     * @param {Object} registrationRequest\n     * @return {Promise} jQuery Deferred object\n     */\n    var initiateRegistration = function(url) {\n\n        // Show the external registration page in an iframe.\n        var container = getLTIAdvRegistrationContainer();\n        var iframe = container.append(\"<iframe src='/mod/lti/startltiadvregistration.php?url=\"\n            + encodeURIComponent( url ) + \"'></iframe>\");\n        showLTIAdvRegistrationContainer();\n\n        window.addEventListener(\"message\", (e=>{\n            if (e.data && 'org.ims.global.close' === e.data.subject) {\n                iframe.remove();\n            }\n        }), false);\n    };\n\n    /**\n     * Sets up the listeners for user interaction on the page.\n     *\n     * @method registerEventListeners\n     * @private\n     */\n    var registerEventListeners = function() {\n\n        $(document).on(ltiEvents.START_LTIADV_REGISTRATION, function(event, data) {\n                if (!data) {\n                    return;\n                }\n                if (data.url) {\n                    initiateRegistration(data.url);\n                }\n            });\n\n        // This is gross but necessary due to isolated jQuery scopes between\n        // child iframe and parent windows. There is no other way to communicate.\n        //\n        // This function gets called by the moodle page that received the redirect\n        // from the external registration page and handles the external page's returned\n        // parameters.\n        //\n        // See AMD module mod_lti/external_registration_return.\n    };\n\n    return /** @alias module:mod_lti/external_registration */ {\n\n        /**\n         * Initialise this module.\n         */\n        init: function() {\n            registerEventListeners();\n        }\n    };\n});\n"],"file":"ltiadv_registration.min.js"}