YUI.add("moodle-atto_lti-button",function(d,t){require(["core/str"],function(t){var i=null,e=t.get_string("erroroccurred","atto_lti");$.when(e).done(function(t){i=t}),document.CALLBACKS={handleError:function(t){alert(i);for(var e=0;e<t.length;e++);}}}),d.namespace("M.atto_lti").Button=d.Base.create("button",d.M.editor_atto.EditorPlugin,[],{_CREATEACTIVITYURL:M.cfg.wwwroot+"/lib/editor/atto/plugins/lti/view.php",_CONTENT_ITEM_SELECTION_URL:M.cfg.wwwroot+"/mod/lti/contentitem.php",_panel:null,_addTool:function(t,n){t.preventDefault();var r,l=this._createResourceLinkId(),c=this.get("host"),s=this._course;document.CALLBACKS["f"+l]=function(t){var e,i,a,o=t&&t["@graph"]||[];for(r.hide(),e=0;e<o.length;e++)i=o[e],a=(new d.M.atto_lti.PlacementStrategyFactory).strategyFor(i,s,l,n).toHtml,c.insertContentAtFocusPoint(a(i));c.saveSelection(),c.updateOriginal(),r.destroy()},this._panel=new M.core.dialogue({bodyContent:'<iframe src="'+this._CONTENT_ITEM_SELECTION_URL+"?placement=richtexteditor&course="+this._course.id+"&id="+n.id+"&callback=f"+l+'" width="100%" height="100%"></iframe>',headerContent:n.name,width:"67%",height:"66%",draggable:!1,visible:!0,zindex:100,modal:!0,focusAfterHide:c.editor,focusOnPreviousTargetAfterHide:!0,render:!0}),this._panel.after("visibleChange",function(){this._panel.destroy()},this),r=this._panel},initializer:function(t){var e;0<t.toolTypes.length&&(this._course=t.course,this._createResourceLinkId=(e=t.resourcebase,function(){return e+"_"+(new Date).getTime()}),this.addToolbarMenu({icon:M.util.image_url("icon","mod_lti"),globalItemConfig:{callback:this._addTool},items:t.toolTypes.map(function(t){return{text:t.name,callbackArgs:t}})}))}}),d.namespace("M.atto_lti").PlacementStrategyFactory=function(){this.strategyFor=function(t,e,i,a){var o=d.M.atto_lti.EmbeddedContentRenderingStrategy;if("application/vnd.ims.lti.v1.ltilink"==t.mediaType)o=d.M.atto_lti.LTIIframeRenderingStrategy;else if(t.placementAdvice)switch(t.placementAdvice.presentationDocumentTarget){case"window":case"popup":case"overlay":o=d.M.atto_lti.PlaceholderRenderingStrategy}return new o(t,e,i,a)}},d.namespace("M.atto_lti").EmbeddedContentRenderingStrategy=function(t,e,i,a){var o,n=t.mediaType.split("/"),r=n[0],l={image:d.Handlebars.compile('<img src="{{url}}" alt="{{alt}}" {{#if width}}width="{{width}}" {{/if}}{{#if height}}height="{{height}}" {{/if}}{{#if presentation}}role="presentation" {{/if}}{{#if customstyle}}style="{{customstyle}}" {{/if}}{{#if classlist}}class="{{classlist}}" {{/if}}{{#if id}}id="{{id}}" {{/if}} />'),audio:d.Handlebars.compile('<audio src="{{url}}" controls="controls">Your computer does not support audio playback</audio>'),video:d.Handlebars.compile('<video src="{{url}}"{{#if width}}width="{{width}}" {{/if}}{{#if height}}height="{{height}}" {{/if}}{{#if presentationAdvice.width}}width="{{width}}" {{/if}}{{#if presentationAdvice.height}}height="{{height}}" {{/if}}></video>')};switch(r){case"application":"vnd.ims.lti.v1.ltilink"==n[1]?o=l.ltiLink({item:t,toolid:a.id,resourcelinkid:i,course:e}):alert("Unrecognized application subtype");break;case"text":o=t.text;break;case"image":o=l.image({url:t.url,alt:t.title,width:t.width,height:t.height,presentation:!0});break;case"audio":o=l.audio(t);break;case"video":o=l.video(t);break;default:alert("Unrecognized type")}this.toHtml=function(){return o}},d.namespace("M.atto_lti").ImageRenderingStrategy=function(t,e,i,a){var o=d.Handlebars.compile('<img src="{{url}}" alt="{{title}}" {{#if width}}width="{{width}}" {{/if}}{{#if height}}height="{{height}}" {{/if}}{{#if presentation}}role="presentation" {{/if}}{{#if customstyle}}style="{{customstyle}}" {{/if}}{{#if classlist}}class="{{classlist}}" {{/if}}{{#if id}}id="{{id}}" {{/if}}/>');this.toHtml=function(){return o({item:t})}},d.namespace("M.atto_lti").LTIIframeRenderingStrategy=function(t,e,i,a){var o,n,r;t.url!==a.baseurl&&t.url!==a.config.toolurl_ContentItemSelectionRequest&&(t.useCustomUrl=!0),n=t.placementAdvice&&t.placementAdvice.displayWidth?t.placementAdvice.displayWidth:800,r=t.placementAdvice&&t.placementAdvice.displayWidth?t.placementAdvice.displayHeight:Math.floor(n/4*3),o=d.Handlebars.compile('<iframe src="/lib/editor/atto/plugins/lti/launch.php?orig_course={{courseId}}&ltitypeid={{ltiTypeId}}&custom={{custom}}{{#if item.useCustomUrl}}&contenturl={{item.url}}{{/if}}&resourcelinkid={{resourcelinkid}}"  width="{{width}}"  height="{{height}}" ></iframe>'),this.toHtml=function(){return o({item:t,custom:JSON.stringify(t.custom),courseId:e.id,resourcelinkid:i,ltiTypeId:a.id,width:n,height:r})}},d.namespace("M.atto_lti").PlaceholderRenderingStrategy=function(t){var e,i;switch(d.M.atto_lti.PlaceholderRenderingStrategy.superclass.constructor.apply(this,arguments),e=new("undefined"!=typeof t.thumbnail?d.M.atto_lti.PreviewImagePlaceholderStrategy:"undefined"!=typeof t.icon?d.M.atto_lti.IconPlaceholderStrategy:d.M.atto_lti.TextPlaceholderStrategy)(t),t.placementAdvice.presentationDocumentTarget){case"window":case"popup":case"overlay":i=new d.M.atto_lti.NewWindowTargetAction(t,e);break;default:alert("Unrecognized presentation document target")}this.toHtml=function(){return i.toHtml()}},d.namespace("M.atto_lti").PreviewImagePlaceholderStrategy=function(t){d.M.atto_lti.PreviewImagePlaceholderStrategy.superclass.constructor.call(this,t);var e=d.Handlebars.compile('<img src="{{thumbnail[@id}}" width="{{thumbnail.width}}"  height="{{thumbnail.height}}"  alt="{{title}}" />');this.toHtml=function(){return e({thumnbail:t.thumbnail,title:t.title})}},d.namespace("M.atto_lti").IconPlaceholderStrategy=function(t){d.M.atto_lti.IconPlaceholderStrategy.superclass.constructor.call(this,t);var e=d.Handlebars.compile('<img src="{{icon[@id]}}" width="{{icon.width}}"  height="{{icon.height}}"  alt="{{title}}" />');this.toHtml=function(){return e({icon:t.icon,title:t.title})}},d.namespace("M.atto_lti").TextPlaceholderStrategy=function(t){d.M.atto_lti.TextPlaceholderStrategy.superclass.constructor.call(this,t),
this.toHtml=function(){return t.text?t.text:t.title}},d.namespace("M.atto_lti").NewWindowTargetAction=function(t,e){var i=d.Handlebars.compile('<a href="{{item.url}}" target="_blank">{{placeholder.toHtml()}}</a>');this.toHtml=function(){return i({item:t,placeholder:e})}}},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});