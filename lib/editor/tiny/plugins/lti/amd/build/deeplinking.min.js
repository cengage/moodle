define("tiny_lti/deeplinking",["exports","core/templates","core/str","./common","core/modal_factory","core/modal_events"],(function(_exports,_templates,_str,_common,Modal,ModalEvents){var obj;
/*
   * @package    tiny_lti
   * @copyright  Claude Vervoort Cengage Group <claude.vervoort@cengage.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj},Modal=_interopRequireWildcard(Modal),ModalEvents=_interopRequireWildcard(ModalEvents);return _exports.default=class{constructor(editor){this.editor=editor,this.modal=null,this.callback="dlr"+Math.floor(9999999*Math.random()),document.CALLBACKS=document.CALLBACKS||{}}destroy(){delete this.editor,delete document.CALLBACKS[this.callback],this.modal.destroy(),delete this.modal}async displayDialogue(item){const startUrl=item.url+"&callback=".concat(this.callback);this.modal=await Modal.create({type:Modal.types.DEFAULT,large:!0,title:(0,_str.get_string)("pluginname",_common.component),body:this.getDialogueContent(startUrl)}),this.modal.getRoot().on(ModalEvents.hidden,(()=>this.destroy())),this.modal.getRoot()[0].addEventListener("click",(event=>{const faultLink=event.target.closest('[data-action="highlightfault"]');if(!faultLink)return;event.preventDefault();const nodeName=faultLink.dataset.nodeName;let selectedNode=null;if(nodeName)if(nodeName.includes(",")||"body"===nodeName)selectedNode=this.editor.dom.select("body")[0];else{var _faultLink$dataset$no;const nodeIndex=null!==(_faultLink$dataset$no=faultLink.dataset.nodeIndex)&&void 0!==_faultLink$dataset$no?_faultLink$dataset$no:0;selectedNode=this.editor.dom.select(nodeName)[nodeIndex]}selectedNode&&"BODY"!==selectedNode.nodeName.toUpperCase()&&this.selectAndScroll(selectedNode),this.modal.hide()})),document.CALLBACKS[this.callback]=response=>{(response.items||[]).forEach((i=>this.addToEditor(i))),this.modal.hide()},this.modal.show()}async getDialogueContent(startUrl){return _templates.default.render("tiny_lti/deeplinking",{startUrl:startUrl})}addToEditor(item){if("application/vnd.ims.lti.v1.ltilink"===item.mediaType){var mode="embed",windowTarget="_blank";if(item.placementAdvice)switch(item.placementAdvice.presentationDocumentTarget){case"window":case"popup":case"overlay":mode="window",windowTarget=item.placementAdvice.windowTarget||windowTarget}var width=item.placementAdvice&&item.placementAdvice.displayWidth?parseInt(item.placementAdvice.displayWidth):800,height=item.placementAdvice&&item.placementAdvice.displayWidth?parseInt(item.placementAdvice.displayHeight):Math.floor(width/4*3);this.editor.insertContent('<a href="'.concat(item.ltiurl,'"\n                data-lti="').concat(mode,";width:").concat(width,"px;height:").concat(height,'px"\n                target="').concat(windowTarget,'">').concat(item.text,"</a>"))}else if("text/html"===item.mediaType)if(item.embed&&item.embed.html&&this.editor.insertContent(item.embed.html),item.url){const target=item.window&&item.window.targetName||"_blank";this.editor.insertContent("<a href='".concat(item.url,"' target='").concat(target,"'>").concat(item.text||item.title||"","</a>"))}else this.editor.insertContent(item.text);else item.mediaType.startsWith("image/")&&this.editor.insertContent("<img src='".concat(item.url,"' alt='").concat(item.title||"","'>"))}},_exports.default}));

//# sourceMappingURL=deeplinking.min.js.map